# 8	Компонентная архитектура

## 8.1.	Обоснование выбора архитектурного стиля



## 8.2.	Диаграмма компонентов

![](../diagrams/component_diagram.svg)

## 8.3 Таблица информационных потоков

| № | Источник (Контейнер) | Приемник (Контейнер) | Передаваемая информация / Событие (Сущности) | Протокол / Метод взаимодействия |
|---|----------------------|----------------------|---------------------------------------------|--------------------------------|
| 1 | Веб-клиент | API Gateway | Учетные данные (логин/пароль), Данные для создания заказа (состав, адрес, комментарий), Запросы на получение меню и статуса заказов | HTTPS / REST API |
| 2 | Мобильное приложение | API Gateway | Учетные данные (логин/пароль), Данные для создания заказа (состав, адрес, комментарий), Запросы на получение меню и статуса заказов, Token для Push-уведомлений | HTTPS / REST API |
| 3 | Терминал сотрудника | API Gateway | Команды на изменение статуса заказа, Запросы на обновление меню, Запросы на списки заказов | HTTPS / REST API |
| 4 | Табло заказов | API Gateway | Запросы агрегированных данных для отчетов (метрики по выручке, заказам) | HTTPS / REST API |
| 5 | Сервисный портал | API Gateway | Запросы и данные для управления пользователями, настройками системы, просмотра логов | HTTPS / REST API |
| 6 | API Gateway | Сервис аутентификации | Учетные данные для проверки, JWT-токен для валидации | HTTP / REST API |
| 7 | API Gateway | Сервис заказов | Запрос на создание заказа, Запрос на получение статуса заказа | HTTP / REST API |
| 8 | API Gateway | Сервис меню | Запрос на получение актуального меню | HTTP / REST API |
| 9 | API Gateway | Сервис оплаты | Запрос на инициализацию платежа | HTTP / REST API |
| 10 | API Gateway | Сервис уведомлений | Запросы на управление шаблонами и рассылками | HTTP / REST API |
| 11 | Сервис заказов | Сервис меню | Запрос на валидацию состава заказа | HTTP / REST API (синхронный вызов) |
| 12 | Сервис заказов | Сервис оплаты | Запрос на финальную инициализацию платежа после создания заказа (PaymentOrderRequest: order_id, итоговая сумма) | HTTP / REST API |
| 13 | Сервис заказов | Брокер сообщений (MQ) | Событие OrderCreated (данные заказа: order_id, status, user_id, состав, общая сумма, адрес доставки) | AMQP / Kafka Protocol (JSON) |
| 14 | Сервис оплаты | Брокер сообщений (MQ) | Событие PaymentProcessed (order_id, payment_id, статус оплаты, сумма, timestamp) | AMQP / Kafka Protocol (JSON) |
| 15 | Брокер сообщений (MQ) | Сервис уведомлений | События OrderCreated, PaymentProcessed, другие бизнес-события для триггеров уведомлений | AMQP / Kafka Protocol (JSON) |
| 16 | Брокер сообщений (MQ) | Сервис интеграции с 1C | События OrderCreated (со статусом "Выполнен"), PaymentProcessed (успешные) для синхронизации данных с системой учета | AMQP / Kafka Protocol (JSON) |
| 17 | Брокер сообщений (MQ) | Сервис управления роботами | События OrderCreated (со статусом "В приготовлении"), PaymentProcessed (успешные) для запуска автоматических процессов | AMQP / Kafka Protocol (JSON) |
| 18 | Сервис аутентификации | БД аутентификации | Сущности: User (логин, хэш пароля, роли), Token (JWT-токены) | JDBC |
| 19 | Сервис заказов | БД заказов | Сущности: Order (статус, сумма, клиент), OrderItem (позиция, количество, цена на момент заказа) | JDBC |
| 20 | Сервис меню | БД меню | Сущности: MenuItem (название, описание, цена, категория, наличие), Category | JDBC |
| 21 | Сервис уведомлений | БД уведомлений | Сущности: Notification (получатель, тип, статус, содержимое), Template (шаблоны SMS/email/push) | JDBC |
| 22 | Сервис оплаты | Эквайринг | PaymentRequest (сумма, валюта, описание заказа, токенизированные данные карты или ссылка на платежную форму) | HTTPS / REST API (PSI) |
| 23 | Сервис интеграции с 1C | 1C:Предприятие | Сущности для синхронизации: Финансовые операции (заказы, платежи), Номенклатура (списание ингредиентов) | HTTPS / OData API |
| 24 | Сервис управления роботами | Система управления роботами | RobotCommand (идентификатор робота/линии, действие command, параметры parameters) | MQTT / WebSockets (JSON) |


## 8.3.	Описание компонентов